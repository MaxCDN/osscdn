(function(){"use strict";function n(e,t,n){this.cm=e,this.getHints=t,this.options=n,this.widget=this.onClose=null}function r(e){return typeof e=="string"?e:e.text}function i(e,t){function i(e,i){var s;typeof i!="string"?s=function(e){return i(e,t)}:n.hasOwnProperty(i)?s=n[i]:s=i,r[e]=s}var n={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(-t.menuSize()+1,!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Home:function(){t.setFocus(0)},End:function(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},r=e.customKeys?{}:n;if(e.customKeys)for(var s in e.customKeys)e.customKeys.hasOwnProperty(s)&&i(s,e.customKeys[s]);if(e.extraKeys)for(var s in e.extraKeys)e.extraKeys.hasOwnProperty(s)&&i(s,e.extraKeys[s]);return r}function s(e,t){while(t&&t!=e){if(t.nodeName.toUpperCase()==="LI")return t;t=t.parentNode}}function o(n,o){this.completion=n,this.data=o;var u=this,a=n.cm,f=n.options,l=this.hints=document.createElement("ul");l.className="CodeMirror-hints",this.selectedHint=f.getDefaultSelection?f.getDefaultSelection(a,f,o):0;var c=o.list;for(var h=0;h<c.length;++h){var p=l.appendChild(document.createElement("li")),d=c[h],v=e+(h!=this.selectedHint?"":" "+t);d.className!=null&&(v=d.className+" "+v),p.className=v,d.render?d.render(p,o,d):p.appendChild(document.createTextNode(d.displayText||r(d))),p.hintId=h}var m=a.cursorCoords(f.alignWithWord!==!1?o.from:null),g=m.left,y=m.bottom,b=!0;l.style.left=g+"px",l.style.top=y+"px";var w=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),E=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(f.container||document.body).appendChild(l);var S=l.getBoundingClientRect(),x=S.right-w,T=S.bottom-E;x>0&&(S.right-S.left>w&&(l.style.width=w-5+"px",x-=S.right-S.left-w),l.style.left=(g=m.left-x)+"px");if(T>0){var N=S.bottom-S.top;S.top-(m.bottom-m.top)-N>0?(T=N+(m.bottom-m.top),b=!1):N>E&&(l.style.height=E-5+"px",T-=N-E),l.style.top=(y=m.bottom-T)+"px"}a.addKeyMap(this.keyMap=i(f,{moveFocus:function(e,t){u.changeActive(u.selectedHint+e,t)},setFocus:function(e){u.changeActive(e)},menuSize:function(){return u.screenAmount()},length:c.length,close:function(){n.close()},pick:function(){u.pick()}}));if(f.closeOnUnfocus!==!1){var C;a.on("blur",this.onBlur=function(){C=setTimeout(function(){n.close()},100)}),a.on("focus",this.onFocus=function(){clearTimeout(C)})}var k=a.getScrollInfo();return a.on("scroll",this.onScroll=function(){var e=a.getScrollInfo(),t=a.getWrapperElement().getBoundingClientRect(),r=y+k.top-e.top,i=r-(window.pageYOffset||(document.documentElement||document.body).scrollTop);b||(i+=l.offsetHeight);if(i<=t.top||i>=t.bottom)return n.close();l.style.top=r+"px",l.style.left=g+k.left-e.left+"px"}),CodeMirror.on(l,"dblclick",function(e){var t=s(l,e.target||e.srcElement);t&&t.hintId!=null&&(u.changeActive(t.hintId),u.pick())}),CodeMirror.on(l,"click",function(e){var t=s(l,e.target||e.srcElement);t&&t.hintId!=null&&u.changeActive(t.hintId)}),CodeMirror.on(l,"mousedown",function(){setTimeout(function(){a.focus()},20)}),CodeMirror.signal(o,"select",c[0],l.firstChild),!0}var e="CodeMirror-hint",t="CodeMirror-hint-active";CodeMirror.showHint=function(e,t,r){if(e.somethingSelected())return;t==null&&(t=e.getHelper(e.getCursor(),"hint"));if(t==null)return;e.state.completionActive&&e.state.completionActive.close();var i=e.state.completionActive=new n(e,t,r||{});CodeMirror.signal(e,"startCompletion",e);if(!i.options.async)return i.showHints(t(e,i.options));t(e,function(e){i.showHints(e)},i.options)},n.prototype={close:function(){if(!this.active())return;this.cm.state.completionActive=null,this.widget&&this.widget.close(),this.onClose&&this.onClose(),CodeMirror.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(e,t){var n=e.list[t];n.hint?n.hint(this.cm,e,n):this.cm.replaceRange(r(n),e.from,e.to),this.close()},showHints:function(e){if(!e||!e.list.length||!this.active())return this.close();this.options.completeSingle!=0&&e.list.length==1?this.pick(e,0):this.showWidget(e)},showWidget:function(e){function a(){if(r)return;r=!0,n.close(),n.cm.off("cursorActivity",c),e&&CodeMirror.signal(e,"close")}function f(){if(r)return;CodeMirror.signal(e,"update"),n.options.async?n.getHints(n.cm,l,n.options):l(n.getHints(n.cm,n.options))}function l(t){e=t;if(r)return;if(!e||!e.list.length)return a();n.widget=new o(n,e)}function c(){clearTimeout(t);var e=n.cm.getCursor(),r=n.cm.getLine(e.line);e.line!=s.line||r.length-e.ch!=u-s.ch||e.ch<s.ch||n.cm.somethingSelected()||e.ch&&i.test(r.charAt(e.ch-1))?n.close():(t=setTimeout(f,170),n.widget&&n.widget.close())}this.widget=new o(this,e),CodeMirror.signal(e,"shown");var t=null,n=this,r,i=this.options.closeCharacters||/[\s()\[\]{};:>,]/,s=this.cm.getCursor(),u=this.cm.getLine(s.line).length;this.cm.on("cursorActivity",c),this.onClose=a}},o.prototype={close:function(){if(this.completion.widget!=this)return;this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus!==!1&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(e,n){e>=this.data.list.length?e=n?this.data.list.length-1:0:e<0&&(e=n?0:this.data.list.length-1);if(this.selectedHint==e)return;var r=this.hints.childNodes[this.selectedHint];r.className=r.className.replace(" "+t,""),r=this.hints.childNodes[this.selectedHint=e],r.className+=" "+t,r.offsetTop<this.hints.scrollTop?this.hints.scrollTop=r.offsetTop-3:r.offsetTop+r.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=r.offsetTop+r.offsetHeight-this.hints.clientHeight+3),CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],r)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}}})();