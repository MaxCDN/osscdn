(function(){"use strict";CodeMirror.defineMode("haml",function(e){function r(e){return function(t,n){var r=t.peek();return r==e&&n.rubyState.tokenize.length==1?(t.next(),n.tokenize=s,"closeAttributeTag"):i(t,n)}}function i(e,t){return e.match("-#")?(e.skipToEnd(),"comment"):n.token(e,t.rubyState)}function s(e,n){var s=e.peek();if(n.previousToken.style=="comment"&&n.indented>n.previousToken.indented)return e.skipToEnd(),"commentLine";if(n.startOfLine){if(s=="!"&&e.match("!!"))return e.skipToEnd(),"tag";if(e.match(/^%[\w:#\.]+=/))return n.tokenize=i,"hamlTag";if(e.match(/^%[\w:]+/))return"hamlTag";if(s=="/")return e.skipToEnd(),"comment"}if(n.startOfLine||n.previousToken.style=="hamlTag")if(s=="#"||s==".")return e.match(/[\w-#\.]*/),"hamlAttribute";if(n.startOfLine&&!e.match("-->",!1)&&(s=="="||s=="-"))return n.tokenize=i,null;if(n.previousToken.style=="hamlTag"||n.previousToken.style=="closeAttributeTag"||n.previousToken.style=="hamlAttribute"){if(s=="(")return n.tokenize=r(")"),null;if(s=="{")return n.tokenize=r("}"),null}return t.token(e,n.htmlState)}var t=CodeMirror.getMode(e,{name:"htmlmixed"}),n=CodeMirror.getMode(e,"ruby");return{startState:function(){var e=t.startState(),r=n.startState();return{htmlState:e,rubyState:r,indented:0,previousToken:{style:null,indented:0},tokenize:s}},copyState:function(e){return{htmlState:CodeMirror.copyState(t,e.htmlState),rubyState:CodeMirror.copyState(n,e.rubyState),indented:e.indented,previousToken:e.previousToken,tokenize:e.tokenize}},token:function(e,t){e.sol()&&(t.indented=e.indentation(),t.startOfLine=!0);if(e.eatSpace())return null;var n=t.tokenize(e,t);t.startOfLine=!1,n&&n!="commentLine"&&(t.previousToken={style:n,indented:t.indented});if(e.eol()&&t.tokenize==i){e.backUp(1);var r=e.peek();e.next(),r&&r!=","&&(t.tokenize=s)}return n=="hamlTag"?n="tag":n=="commentLine"?n="comment":n=="hamlAttribute"?n="attribute":n=="closeAttributeTag"&&(n=null),n},indent:function(e){return e.indented}}},"htmlmixed","ruby"),CodeMirror.defineMIME("text/x-haml","haml")})();