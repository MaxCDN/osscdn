CodeMirror.defineMode("smalltalk",function(e){var t=/[+\-\/\\*~<>=@%|&?!.,:;^]/,n=/true|false|nil|self|super|thisContext/,r=function(e,t){this.next=e,this.parent=t},i=function(e,t,n){this.name=e,this.context=t,this.eos=n},s=function(){this.context=new r(o,null),this.expectVariable=!0,this.indentation=0,this.userIndentationDelta=0};s.prototype.userIndent=function(t){this.userIndentationDelta=t>0?t/e.indentUnit-this.indentation:0};var o=function(e,s,o){var c=new i(null,s,!1),h=e.next();return h==='"'?c=u(e,new r(u,s)):h==="'"?c=a(e,new r(a,s)):h==="#"?e.peek()==="'"?(e.next(),c=f(e,new r(f,s))):(e.eatWhile(/[^ .\[\]()]/),c.name="string-2"):h==="$"?(e.next()==="<"&&(e.eatWhile(/[^ >]/),e.next()),c.name="string-2"):h==="|"&&o.expectVariable?c.context=new r(l,s):/[\[\]{}()]/.test(h)?(c.name="bracket",c.eos=/[\[{(]/.test(h),h==="["?o.indentation++:h==="]"&&(o.indentation=Math.max(0,o.indentation-1))):t.test(h)?(e.eatWhile(t),c.name="operator",c.eos=h!==";"):/\d/.test(h)?(e.eatWhile(/[\w\d]/),c.name="number"):/[\w_]/.test(h)?(e.eatWhile(/[\w\d_]/),c.name=o.expectVariable?n.test(e.current())?"keyword":"variable":null):c.eos=o.expectVariable,c},u=function(e,t){return e.eatWhile(/[^"]/),new i("comment",e.eat('"')?t.parent:t,!0)},a=function(e,t){return e.eatWhile(/[^']/),new i("string",e.eat("'")?t.parent:t,!1)},f=function(e,t){return e.eatWhile(/[^']/),new i("string-2",e.eat("'")?t.parent:t,!1)},l=function(e,t){var n=new i(null,t,!1),r=e.next();return r==="|"?(n.context=t.parent,n.eos=!0):(e.eatWhile(/[^|]/),n.name="variable"),n};return{startState:function(){return new s},token:function(e,t){t.userIndent(e.indentation());if(e.eatSpace())return null;var n=t.context.next(e,t.context,t);return t.context=n.context,t.expectVariable=n.eos,n.name},blankLine:function(e){e.userIndent(0)},indent:function(t,n){var r=t.context.next===o&&n&&n.charAt(0)==="]"?-1:t.userIndentationDelta;return(t.indentation+r)*e.indentUnit},electricChars:"]"}}),CodeMirror.defineMIME("text/x-stsrc",{name:"smalltalk"});