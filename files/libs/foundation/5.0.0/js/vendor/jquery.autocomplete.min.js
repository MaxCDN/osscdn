!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function d(b,c){var e=function(){},f=this,g={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:d.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:e,onSearchComplete:e,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b}};f.element=b,f.el=a(b),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse=[],f.onChangeInterval=null,f.onChange=null,f.ignoreValueChange=!1,f.isLocal=!1,f.suggestionsContainer=null,f.options=a.extend({},g,c),f.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},f.initialize(),f.setOptions(c)}var b=function(){return{extend:function(b,c){return a.extend(b,c)},createNode:function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild}}}(),c={ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40};d.utils=b,a.Autocomplete=d,d.formatResult=function(a,b){var c=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),d="("+b.replace(c,"\\$1")+")";return a.value.replace(new RegExp(d,"gi"),"<strong>$1</strong>")},d.prototype={killerFn:null,initialize:function(){var g,b=this,c="."+b.classes.suggestion,e=b.classes.selected,f=b.options;b.element.setAttribute("autocomplete","off"),b.killerFn=function(c){0===a(c.target).closest("."+b.options.containerClass).length&&(b.killSuggestions(),b.disableKillerFn())},f.width&&"auto"!==f.width||(f.width=b.el.outerWidth()),b.suggestionsContainer=d.utils.createNode('<div class="'+f.containerClass+'" style="position: absolute; display: none;"></div>'),g=a(b.suggestionsContainer),g.appendTo(f.appendTo).width(f.width),g.on("mouseover.autocomplete",c,function(){b.activate(a(this).data("index"))}),g.on("mouseout.autocomplete",function(){b.selectedIndex=-1,g.children("."+e).removeClass(e)}),g.on("click.autocomplete",c,function(){b.select(a(this).data("index"),!1)}),b.fixPosition(),window.opera?b.el.on("keypress.autocomplete",function(a){b.onKeyPress(a)}):b.el.on("keydown.autocomplete",function(a){b.onKeyPress(a)}),b.el.on("keyup.autocomplete",function(a){b.onKeyUp(a)}),b.el.on("blur.autocomplete",function(){b.onBlur()}),b.el.on("focus.autocomplete",function(){b.fixPosition()})},onBlur:function(){this.enableKillerFn()},setOptions:function(c){var d=this,e=d.options;b.extend(e,c),d.isLocal=a.isArray(e.lookup),d.isLocal&&(e.lookup=d.verifySuggestionsFormat(e.lookup)),a(d.suggestionsContainer).css({"max-height":e.maxHeight+"px",width:e.width+"px","z-index":e.zIndex})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue=null,this.suggestions=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var c,b=this;"body"===b.options.appendTo&&(c=b.el.offset(),a(b.suggestionsContainer).css({top:c.top+b.el.outerHeight()+"px",left:c.left+"px"}))},enableKillerFn:function(){var b=this;a(document).on("click.autocomplete",b.killerFn)},disableKillerFn:function(){var b=this;a(document).off("click.autocomplete",b.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions(),a.intervalId=window.setInterval(function(){a.hide(),a.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(a){var b=this;if(!b.disabled&&!b.visible&&a.keyCode===c.DOWN&&b.currentValue)return b.suggest(),void 0;if(!b.disabled&&b.visible){switch(a.keyCode){case c.ESC:b.el.val(b.currentValue),b.hide();break;case c.TAB:case c.RETURN:if(-1===b.selectedIndex)return b.hide(),void 0;if(b.select(b.selectedIndex,a.keyCode===c.RETURN),a.keyCode===c.TAB&&this.options.tabDisabled===!1)return;break;case c.UP:b.moveUp();break;case c.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.keyCode){case c.UP:case c.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var b,a=this;return clearInterval(a.onChangeInterval),a.currentValue=a.element.value,b=a.getQuery(a.currentValue),a.selectedIndex=-1,a.ignoreValueChange?(a.ignoreValueChange=!1,void 0):(b.length<a.options.minChars?a.hide():a.getSuggestions(b),void 0)},getQuery:function(b){var d,c=this.options.delimiter;return c?(d=b.split(c),a.trim(d[d.length-1])):a.trim(b)},getSuggestionsLocal:function(b){var c=this,d=b.toLowerCase(),e=c.options.lookupFilter;return{suggestions:a.grep(c.options.lookup,function(a){return e(a,b,d)})}},getSuggestions:function(b){var c,d=this,e=d.options,f=e.serviceUrl;if(c=d.isLocal?d.getSuggestionsLocal(b):d.cachedResponse[b],c&&a.isArray(c.suggestions))d.suggestions=c.suggestions,d.suggest();else if(!d.isBadQuery(b)){if(e.params[e.paramName]=b,e.onSearchStart.call(d.element,e.params)===!1)return;a.isFunction(e.serviceUrl)&&(f=e.serviceUrl.call(d.element,b)),a.ajax({url:f,data:e.ignoreParams?null:e.params,type:e.type,dataType:e.dataType}).done(function(a){d.processResponse(a,b),e.onSearchComplete.call(d.element,b)})}},isBadQuery:function(a){for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var b=this;b.visible=!1,b.selectedIndex=-1,a(b.suggestionsContainer).hide()},suggest:function(){if(0===this.suggestions.length)return this.hide(),void 0;var b=this,c=b.options.formatResult,d=b.getQuery(b.currentValue),e=b.classes.suggestion,f=b.classes.selected,g=a(b.suggestionsContainer),h="";a.each(b.suggestions,function(a,b){h+='<div class="'+e+'" data-index="'+a+'">'+c(b,d)+"</div>"}),g.html(h).show(),b.visible=!0,b.options.autoSelectFirst&&(b.selectedIndex=0,g.children().first().addClass(f))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(a,b){var c=this,d=c.options,e=d.transformResult(a,b);e.suggestions=c.verifySuggestionsFormat(e.suggestions),d.noCache||(c.cachedResponse[e[d.paramName]]=e,0===e.suggestions.length&&c.badQueries.push(e[d.paramName])),b===c.getQuery(c.currentValue)&&(c.suggestions=e.suggestions,c.suggest())},activate:function(b){var d,c=this,e=c.classes.selected,f=a(c.suggestionsContainer),g=f.children();return f.children("."+e).removeClass(e),c.selectedIndex=b,-1!==c.selectedIndex&&g.length>c.selectedIndex?(d=g.get(c.selectedIndex),a(d).addClass(e),d):null},select:function(a,b){var c=this,d=c.suggestions[a];d&&(c.el.val(d),c.ignoreValueChange=b,c.hide(),c.onSelect(a))},moveUp:function(){var b=this;if(-1!==b.selectedIndex)return 0===b.selectedIndex?(a(b.suggestionsContainer).children().first().removeClass(b.classes.selected),b.selectedIndex=-1,b.el.val(b.currentValue),void 0):(b.adjustScroll(b.selectedIndex-1),void 0)},moveDown:function(){var a=this;a.selectedIndex!==a.suggestions.length-1&&a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(b){var e,f,g,c=this,d=c.activate(b),h=25;d&&(e=d.offsetTop,f=a(c.suggestionsContainer).scrollTop(),g=f+c.options.maxHeight-h,f>e?a(c.suggestionsContainer).scrollTop(e):e>g&&a(c.suggestionsContainer).scrollTop(e-c.options.maxHeight+h),c.el.val(c.getValue(c.suggestions[b].value)))},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b];c.el.val(c.getValue(e.value)),a.isFunction(d)&&d.call(c.element,e)},getValue:function(a){var d,e,b=this,c=b.options.delimiter;return c?(d=b.currentValue,e=d.split(c),1===e.length?a:d.substr(0,d.length-e[e.length-1].length)+a):a},dispose:function(){var b=this;b.el.off(".autocomplete").removeData("autocomplete"),b.disableKillerFn(),a(b.suggestionsContainer).remove()}},a.fn.autocomplete=function(b,c){var e="autocomplete";return 0===arguments.length?this.first().data(e):this.each(function(){var f=a(this),g=f.data(e);"string"==typeof b?g&&"function"==typeof g[b]&&g[b](c):(g&&g.dispose&&g.dispose(),g=new d(this,b),f.data(e,g))})}});