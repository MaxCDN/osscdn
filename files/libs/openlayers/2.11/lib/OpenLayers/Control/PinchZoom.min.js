OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerOrigin:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var e=OpenLayers.Control.prototype.activate.apply(this,arguments);return e&&(this.map.events.on({moveend:this.updateContainerOrigin,scope:this}),this.updateContainerOrigin()),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.apply(this,arguments);return this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerOrigin,scope:this}),e},updateContainerOrigin:function(){var e=this.map.layerContainerDiv;this.containerOrigin={x:parseInt(e.style.left,10),y:parseInt(e.style.top,10)}},pinchStart:function(e){this.pinchOrigin=e.xy,this.currentCenter=e.xy},pinchMove:function(e,t){var i=t.scale,n=this.containerOrigin,r=this.pinchOrigin,o=e.xy,s=Math.round(o.x-r.x+(i-1)*(n.x-r.x)),a=Math.round(o.y-r.y+(i-1)*(n.y-r.y));this.applyTransform("translate("+s+"px, "+a+"px) scale("+i+")"),this.currentCenter=o},applyTransform:function(e){var t=this.map.layerContainerDiv.style;t["-webkit-transform"]=e,t["-moz-transform"]=e},pinchDone:function(e,t,i){this.applyTransform("");var n=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0);if(n!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var r=this.map.getResolutionForZoom(n),o=this.map.getLonLatFromPixel(this.pinchOrigin),s=this.currentCenter,a=this.map.getSize();o.lon+=r*(a.w/2-s.x),o.lat-=r*(a.h/2-s.y),this.map.setCenter(o,n)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});